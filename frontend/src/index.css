@import "tailwindcss";

/* Base responsive font sizing */
:root {
  /* Clamp: min, preferred (viewport-based), max */
  --font-xs: clamp(9px, 0.55vw, 11px);
  --font-sm: clamp(10px, 0.65vw, 12px);
  --font-base: clamp(11px, 0.7vw, 14px);
  --font-md: clamp(12px, 0.8vw, 16px);
  --font-lg: clamp(14px, 0.9vw, 18px);
  --font-xl: clamp(16px, 1vw, 22px);
  
  /* Spacing */
  --space-xs: clamp(4px, 0.3vw, 6px);
  --space-sm: clamp(6px, 0.4vw, 10px);
  --space-md: clamp(10px, 0.6vw, 16px);
  --space-lg: clamp(14px, 0.8vw, 24px);
  
  /* Sidebar width - scales with viewport */
  --sidebar-width: clamp(220px, 14vw, 320px);
  --panel-width: clamp(320px, 20vw, 420px);

  /* ──────────────────────────────────────────────────────────────
     Theme tokens (WCAG-friendly contrast)
     Use as: rgb(var(--token) / <alpha>)
     ────────────────────────────────────────────────────────────── */
  /* Light (classic bright UI) */
  --bg: 255 255 255;           /* pure white */
  --surface: 255 255 255;      /* cards/panels */
  --surface-2: 250 252 255;    /* subtle tint for inputs/headers */
  --surface-3: 255 255 255;    /* list cells/cards should stay white */
  --fg: 15 23 42;              /* slate-900 */
  --fg-muted: 51 65 85;        /* slate-700 */
  --muted: 71 85 105;          /* slate-600 */
  --border: 226 232 240;       /* slate-200 */
  --border-strong: 203 213 225;/* slate-300 */
  --ring: 14 165 233;          /* sky-500 */
  --grid: 203 213 225;         /* slate-300 (used with low alpha in JS) */

  /* Semantic */
  --info-bg: 224 242 254;      /* sky-100 */
  --info-fg: 3 105 161;        /* sky-700 */
  --success-bg: 236 253 245;   /* emerald-50 */
  --success-fg: 6 95 70;       /* emerald-800 */
  --warning-bg: 254 243 199;   /* amber-100 */
  --warning-fg: 146 64 14;     /* amber-800 */
  --danger-bg: 254 242 242;    /* red-50 */
  --danger-fg: 185 28 28;      /* red-700 */
  --purple-bg: 245 243 255;    /* violet-50 */
  --purple-fg: 91 33 182;      /* violet-800 */

  /* React Flow accents */
  --handle-border: 15 23 42;
  --edge: 41 181 232;          /* Snowflake blue */
  --edge-active: 245 158 11;   /* amber-500 */
  --edge-success: 16 185 129;  /* emerald-500 */
}

html, body, #root {
  height: 100%;
  width: 100%;
  margin: 0;
  padding: 0;
  font-size: var(--font-base);
}

html {
  color-scheme: light;
}

html.dark {
  color-scheme: dark;
  /* Dark */
  --bg: 11 18 32;             /* deep navy */
  --surface: 15 23 42;        /* slate-900 */
  --surface-2: 17 24 39;      /* slate-900-ish */
  --surface-3: 30 41 59;      /* slate-800 */
  --fg: 226 232 240;          /* slate-200 */
  --fg-muted: 203 213 225;    /* slate-300 */
  --muted: 148 163 184;       /* slate-400 */
  --border: 51 65 85;         /* slate-700 */
  --border-strong: 71 85 105; /* slate-600 */
  --ring: 56 189 248;         /* sky-400 */
  --grid: 148 163 184;        /* slate-400 (used with low alpha in JS) */

  --info-bg: 14 116 144;      /* cyan-700-ish */
  --info-fg: 236 254 255;     /* cyan-50 */
  --success-bg: 5 46 22;      /* green-950 */
  --success-fg: 187 247 208;  /* green-200 */
  --warning-bg: 69 26 3;      /* amber-950 */
  --warning-fg: 254 215 170;  /* amber-200 */
  --danger-bg: 69 10 10;      /* red-950 */
  --danger-fg: 254 202 202;   /* red-200 */
  --purple-bg: 46 16 101;     /* violet-950 */
  --purple-fg: 221 214 254;   /* violet-200 */

  --handle-border: 226 232 240;
}

body {
  background: rgb(var(--bg));
  color: rgb(var(--fg));
}

/* React Flow controls: ensure buttons/icons have proper contrast in both themes.
   Wrap in a Tailwind layer so it survives Tailwind v4 processing consistently. */
@layer base {
  .react-flow__controls {
    background: rgb(var(--surface)) !important;
    border: 1px solid rgb(var(--border)) !important;
    border-radius: 8px !important;
    overflow: hidden;
  }

  .react-flow__controls-button {
    background: transparent !important;
    color: rgb(var(--fg)) !important;
    border: 0 !important;
    border-bottom: 1px solid rgb(var(--border)) !important;
    box-shadow: none !important;
  }

  .react-flow__controls-button:hover {
    background: rgb(var(--surface-2)) !important;
  }

  .react-flow__controls-button:active {
    background: rgb(var(--surface-3)) !important;
  }

  .react-flow__controls-button svg {
    stroke: currentColor !important;
  }
}

/* Focus ring for keyboard users */
:focus-visible {
  outline: 2px solid rgb(var(--ring));
  outline-offset: 2px;
}

/* Remove React Flow's default node wrapper styling - but NOT child content */
.react-flow__node {
  background: transparent !important;
  padding: 0 !important;
  border: none !important;
  box-shadow: none !important;
  outline: none !important;
}

.react-flow__node:focus,
.react-flow__node.selected,
.react-flow__node.selected:focus {
  outline: none !important;
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
}

/* Force all handles to be small round dots */
.react-flow__handle {
  width: 8px !important;
  height: 8px !important;
  min-width: 8px !important;
  min-height: 8px !important;
  max-width: 8px !important;
  max-height: 8px !important;
  border-radius: 50% !important;
  border: 2px solid rgb(var(--handle-border)) !important;
  box-sizing: border-box !important;
}

.react-flow__handle-left {
  left: -4px !important;
}

.react-flow__handle-right {
  right: -4px !important;
}

/* Ultrawide optimizations */
@media (min-width: 2000px) {
  :root {
    --font-xs: 11px;
    --font-sm: 13px;
    --font-base: 15px;
    --font-md: 17px;
    --font-lg: 20px;
    --font-xl: 24px;
    --sidebar-width: 300px;
    --panel-width: 400px;
  }
}

@media (min-width: 2500px) {
  :root {
    --font-xs: 12px;
    --font-sm: 14px;
    --font-base: 16px;
    --font-md: 18px;
    --font-lg: 22px;
    --font-xl: 28px;
    --sidebar-width: 340px;
    --panel-width: 440px;
  }
}

@media (min-width: 3000px) {
  :root {
    --font-xs: 14px;
    --font-sm: 16px;
    --font-base: 18px;
    --font-md: 20px;
    --font-lg: 26px;
    --font-xl: 32px;
    --sidebar-width: 380px;
    --panel-width: 500px;
  }
}

/* Pulse animation for indicators */
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

/* Node glow when active */
@keyframes glow-pulse {
  0%, 100% { 
    box-shadow: 0 0 0 3px rgba(41, 181, 232, 0.3), 0 0 20px 4px rgba(41, 181, 232, 0.5);
  }
  50% { 
    box-shadow: 0 0 0 4px rgba(41, 181, 232, 0.5), 0 0 32px 8px rgba(41, 181, 232, 0.7);
  }
}

/* Removed old edge animations - now using solid edges only */

/* ═══════════════════════════════════════════════════════════════════════════
   CLEAN, PROFESSIONAL NODE STATES - No flashy effects
   ═══════════════════════════════════════════════════════════════════════════ */

/* Active node - subtle orange border, no crazy glow */
.react-flow__node.active-node {
  border: 3px solid #F59E0B !important;
  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3) !important;
  z-index: 100 !important;
  transform: scale(1.02);
  transition: all 0.2s ease;
}

/* Completed node - subtle green border */
.react-flow__node.completed-node {
  border: 2px solid #10B981 !important;
  box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2) !important;
}

/* Simulated node - purple border with small badge */
.react-flow__node.simulated-node {
  border: 2px solid #8B5CF6 !important;
  box-shadow: 0 2px 8px rgba(139, 92, 246, 0.2) !important;
  position: relative;
}

/* Small "SIM" badge for simulated nodes */
.react-flow__node.simulated-node::after {
  content: 'SIM';
  position: absolute;
  top: -8px;
  right: -8px;
  background: #8B5CF6;
  color: white;
  font-size: 7px;
  font-weight: 700;
  padding: 2px 4px;
  border-radius: 4px;
}

/* Active edge - orange highlight */
.react-flow__edge.active-edge path {
  stroke: rgb(var(--edge-active));
  stroke-width: 3;
  opacity: 1;
}

/* Completed edge - green */
.react-flow__edge.completed-edge path {
  stroke: rgb(var(--edge-success));
  stroke-width: 2;
  opacity: 1;
}

/* Default/Idle edges - Snowflake blue */
.react-flow__edge path,
.react-flow__edge.idle-edge path {
  stroke: rgb(var(--edge));
  stroke-width: 2;
  transition: stroke 0.3s ease, stroke-width 0.3s ease;
}

/* Hover affordance: subtle + discoverable (cursor + slight thickening) */
.react-flow__edge:hover {
  cursor: pointer;
}

.react-flow__edge:hover path {
  stroke-width: 3;
  opacity: 1;
}

.react-flow__edge:hover .react-flow__edge-path {
  filter: drop-shadow(0 0 6px rgba(41, 181, 232, 0.25));
}

/* Risky edges (advanced / lower-confidence paths) */
.react-flow__edge.risky-edge path {
  stroke: rgb(var(--edge-active));
  stroke-dasharray: 6 4;
}

/* Risky edge hover: slightly easier to notice without being loud */
.react-flow__edge.risky-edge:hover .react-flow__edge-path {
  filter: drop-shadow(0 0 8px rgba(245, 158, 11, 0.28));
}

/* Box selection (Shift + drag) */
.react-flow__selection {
  background: color-mix(in srgb, rgb(var(--ring)) 14%, transparent) !important;
  border: 1px solid rgb(var(--ring)) !important;
}

/* Selected edge: make it obvious it's selected (required for TEST-3.6) */
.react-flow__edge.selected path,
.react-flow__edge:focus-visible path {
  stroke: rgb(var(--edge-active));
  stroke-width: 4;
}

/* Keep React Flow's default animated dashes */

/* Ensure edge paths are visible */
.react-flow__edge path.react-flow__edge-path {
  fill: none;
  stroke-linecap: round;
}

/* Smooth animations */
.animate-spin {
  animation: spin 1s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}
